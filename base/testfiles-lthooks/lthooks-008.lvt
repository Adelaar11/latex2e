

\RequirePackage[enable-debug]{expl3}
\ExplSyntaxOn
\debug_on:n { check-declarations , deprecation }
\ExplSyntaxOff

\documentclass{article}

\input{regression-test}

\AtEndDocument{\typeout{legacy before hook code loaded}}

\DebugHookOn

\AtEndDocument{\typeout{legacy after hook code loaded code}}



\START


\AddToHook {enddocument}          {\typeout{baz}}
\AddToHook {enddocument} [label1] {\typeout{foo}}
\AddToHook {enddocument} [label2] {\typeout{bar}}

\DeclareHookRule {enddocument} {label2} {before} {top-level}
\DeclareHookRule {enddocument} {label1} {after} {top-level}


\AtEndDocument{\typeout{on top-level}}

\makeatletter
\def\@currname{mypackage}
\AtEndDocument{\typeout{from my package}}
\makeatother

\ExplSyntaxOn
\prop_log:N \g__hook_enddocument_code_prop
\seq_log:N \g__hook_all_seq

\prop_log:c {g__hook_??_rules_prop}
\prop_log:N \g__hook_enddocument_rules_prop
\ExplSyntaxOff

\begin{document}   % initialize the hook code again

\makeatletter
\ExplSyntaxOn
\tl_log:N\@enddocumenthook
\ExplSyntaxOff

\end{document}
